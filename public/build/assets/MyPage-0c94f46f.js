import{Q as de,k as c,r as u,s as H,q as ue,o as a,c as ce,w as R,a as E,u as j,Z as me,b as e,d as o,t as n,e as m,n as C,g as w,i as J,y as pe,F as $,f as xe,j as W,v as X,h as Y,z as ee}from"./app-8b98acf3.js";import{_ as ve}from"./SeihoTestLayout-203107a5.js";const be={class:"mx-auto w-full max-w-3xl px-6 py-10"},ye={key:0,class:"mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm font-semibold text-emerald-700"},fe=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"マイページ"),e("p",{class:"mt-2 text-sm text-gray-500"}," 登録状況の確認や進捗管理ができます。 ")],-1),_e={class:"rounded-2xl border border-gray-100 bg-white p-6 shadow-sm"},ge=e("div",{class:"text-sm text-gray-500"},"ログイン中のユーザー",-1),he={class:"no-data-detectors mt-1 text-lg font-semibold text-gray-800"},ke={class:"mt-6 border-t border-gray-100 pt-4"},we=e("div",{class:"text-sm text-gray-500"},"購入状況",-1),Se={class:"mt-2 text-xs text-gray-500"},je={key:0,class:"mt-3"},Ce={id:"score-input",class:"mt-8 rounded-2xl border border-gray-100 bg-white p-6 shadow-sm"},Ne={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-2"},Me=e("div",{class:"text-sm text-gray-500"},"進捗",-1),Te={key:0,class:"inline-flex items-center rounded-full bg-sky-50 px-2 py-0.5 text-xs font-semibold text-sky-700"},Ve={class:"mt-1 text-lg font-semibold text-gray-800"},qe={class:"text-right"},ze=e("div",{class:"text-xs text-gray-500"},"合格基準",-1),Be={class:"mt-1 flex items-center justify-end gap-2"},Re={key:0,class:"mt-1 text-xs text-amber-700"},Ee={class:"mt-4 h-2 w-full rounded-full bg-gray-100"},$e={class:"mt-4 text-sm text-gray-700"},Ae={key:0,class:"ml-2 inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs font-semibold text-emerald-700"},Oe={key:0,class:"mt-1 text-xs text-amber-700"},Ue={class:"mt-5 space-y-2"},De=["onClick"],Fe={class:"min-w-0 whitespace-nowrap text-[13px] sm:text-sm font-semibold text-gray-800"},Le={class:"grid grid-cols-[56px_52px] sm:grid-cols-[72px_64px] items-center gap-1 sm:gap-2 shrink-0"},Ie={class:"text-right text-xs sm:text-sm text-gray-600 tabular-nums"},Ke={key:0},Qe={key:1,class:"text-gray-400"},Ze={key:1,class:"inline-flex justify-center rounded-full bg-gray-100 px-1.5 sm:px-2 py-0.5 text-[11px] sm:text-xs font-semibold text-gray-500"},Ge={key:2,class:"h-6"},He={class:"mt-8 flex justify-center"},Je=["onClick"],We={class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl"},Xe=e("div",{class:"flex items-center justify-between"},[e("div",{class:"text-lg font-semibold text-gray-900"},"結果を入力")],-1),Ye={class:"mt-4 space-y-4"},et={class:"text-sm font-semibold text-gray-800"},tt=e("label",{class:"block text-sm font-semibold text-gray-700"}," 点数（0〜100） ",-1),st=e("p",{class:"mt-1 text-xs text-gray-500"}," 空欄で保存すると「未入力」に戻せます。 ",-1),lt={key:0,class:"rounded-lg border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-700"},at={class:"mt-6 flex items-center justify-end gap-3"},ot=["disabled"],rt=["onClick"],nt={class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl"},it=e("div",{class:"flex items-center justify-between"},[e("div",{class:"text-lg font-semibold text-gray-900"},"合格基準を変更")],-1),dt={class:"mt-4 space-y-4"},ut=e("label",{class:"block text-sm font-semibold text-gray-700"}," 合格基準（0〜100） ",-1),ct={key:0,class:"rounded-lg border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-700"},mt={class:"mt-6 flex items-center justify-end gap-3"},pt=["disabled"],xt=720,yt={__name:"MyPage",props:{passScore:{type:Number,required:!1,default:null},subjects:{type:Array,required:!0},results:{type:Object,required:!0},hasPremium:{type:Boolean,required:!0}},setup(te){var F,L,I;const A=de(),se=((L=(F=A.props)==null?void 0:F.auth)==null?void 0:L.user)||null,O=c(()=>{var s,t;return((t=(s=A.props)==null?void 0:s.flash)==null?void 0:t.status)??null}),i=te,x=u({...i.results}),b=u(i.passScore),N=u(!1),v=u(((I=i.subjects[0])==null?void 0:I.key)||""),p=u(""),y=u(""),P=u(!1),M=u(!1),f=u(""),h=u(i.passScore??"");H(()=>i.results,s=>{x.value={...s}},{deep:!0}),H(()=>i.passScore,s=>{b.value=s,h.value=s??""});const U=s=>{var r,d,l;y.value="",v.value=s||((r=i.subjects[0])==null?void 0:r.key)||"";const t=((l=(d=x.value)==null?void 0:d[v.value])==null?void 0:l.score)??"";p.value=t===null?"":String(t),N.value=!0},T=()=>{N.value=!1},le=()=>{if(!v.value){y.value="科目を選択してください。";return}const s=p.value===""||p.value===null;if(!s){const t=Number(p.value);if(Number.isNaN(t)||t<0||t>100){y.value="0〜100の点数を入力してください。";return}p.value=String(t)}P.value=!0,ee.post(route("mypage.results"),{subject_key:v.value,score:s?null:Number(p.value)},{headers:{Accept:"application/json"}}).then(()=>{if(s){const t={...x.value};delete t[v.value],x.value=t}else x.value={...x.value,[v.value]:{score:Number(p.value)}};T()}).catch(t=>{var r,d,l,g,K,Q,Z,G;y.value=((g=(l=(d=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:d.errors)==null?void 0:l.score)==null?void 0:g[0])||((G=(Z=(Q=(K=t==null?void 0:t.response)==null?void 0:K.data)==null?void 0:Q.errors)==null?void 0:Z.subject_key)==null?void 0:G[0])||"保存に失敗しました。"}).finally(()=>{P.value=!1})};ue(()=>{const t=new URLSearchParams(window.location.search).get("open_subject");t&&i.subjects.some(r=>r.key===t)&&U(t)});const V=u(!1),ae=()=>{h.value=b.value??"",f.value="",V.value=!0},q=()=>{V.value=!1},oe=()=>{f.value="";const s=Number(h.value);if(Number.isNaN(s)||s<0||s>100){f.value="0〜100の点数を入力してください。";return}M.value=!0,ee.post(route("mypage.passScore"),{pass_score:s},{headers:{Accept:"application/json"}}).then(t=>{var r;b.value=((r=t==null?void 0:t.data)==null?void 0:r.pass_score)??s,q()}).catch(t=>{var r,d,l,g;f.value=((g=(l=(d=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:d.errors)==null?void 0:l.pass_score)==null?void 0:g[0])||"更新に失敗しました。"}).finally(()=>{M.value=!1})},_=c(()=>b.value!==null),S=c(()=>i.subjects.map(s=>{var d,l;const t=((l=(d=x.value)==null?void 0:d[s.key])==null?void 0:l.score)??null,r=_.value&&t!==null&&t>=b.value;return{...s,score:t,passed:r}})),k=c(()=>S.value.filter(s=>s.passed).length),re=c(()=>k.value===8),z=c(()=>S.value.map(s=>s.score??0).reduce((s,t)=>s+t,0)),ne=c(()=>S.value.filter(s=>s.score!==null).length===8),ie=c(()=>ne.value&&k.value===8&&z.value>=720),B=c(()=>Math.max(0,xt-z.value)),D=c(()=>B.value===0);return(s,t)=>(a(),ce(ve,{title:"マイページ"},{default:R(()=>{var r,d;return[E(j(me),{title:"マイページ"}),e("div",be,[O.value?(a(),o("div",ye,n(O.value),1)):m("",!0),fe,e("div",_e,[ge,e("div",he,n(((r=j(se))==null?void 0:r.email)||"未ログイン"),1),e("div",ke,[we,e("div",{class:C(["mt-1 text-sm font-semibold",i.hasPremium?"text-emerald-700":"text-gray-700"])},n(i.hasPremium?"プレミアムプラン購入済み":"プレミアムプラン未購入"),3),e("p",Se,n(i.hasPremium?"全ての解説を閲覧できます。":"プレミアムプランで全ての解説を閲覧できます。"),1),i.hasPremium?m("",!0):(a(),o("div",je,[E(j(J),{href:s.route("pricing"),class:"inline-flex items-center justify-center rounded-full bg-purple-600 px-4 py-2 text-xs font-semibold text-white hover:bg-purple-700 transition"},{default:R(()=>[w(" 料金プランを見る ")]),_:1},8,["href"])]))])]),e("div",Ce,[e("div",Ne,[e("div",null,[e("div",Pe,[Me,re.value?(a(),o("span",Te," 全科目合格達成 ")):m("",!0)]),e("div",Ve,n(k.value)+"/8 ",1)]),e("div",qe,[ze,e("div",Be,[e("span",{class:C(["text-sm font-semibold",_.value?"text-gray-700":"text-amber-700"])},n(_.value?`${b.value} 点`:"未入力"),3),e("button",{type:"button",class:"rounded-full border border-purple-200 bg-white px-3 py-1 text-xs font-semibold text-purple-700 hover:bg-purple-50 transition",onClick:ae},n(_.value?"変更":"入力"),1)]),_.value?m("",!0):(a(),o("div",Re," 合格基準を入力してください "))])]),e("div",Ee,[e("div",{class:"h-2 rounded-full bg-purple-500",style:pe({width:`${k.value/8*100}%`})},null,4)]),e("div",$e,[w(" 合計 "+n(z.value)+" / 800 点 ",1),ie.value?(a(),o("span",Ae," 優秀賞対象 ")):m("",!0)]),e("div",{class:C(["mt-2 inline-flex items-center rounded-lg px-3 py-1.5 text-sm font-semibold",D.value?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"])},[D.value?(a(),o($,{key:0},[w(" 優秀賞基準（720点）到達 ")],64)):(a(),o($,{key:1},[w(" 優秀賞基準（720点）まであと "+n(B.value)+" 点 ",1)],64))],2),B.value===0&&k.value<8?(a(),o("div",Oe," 720点に到達していますが、優秀賞は全8科目の合格が必要です ")):m("",!0),e("div",Ue,[(a(!0),o($,null,xe(S.value,l=>(a(),o("div",{key:l.key,class:"flex items-center justify-between gap-2 rounded-xl border border-gray-100 px-3 py-2.5 sm:px-4 hover:bg-gray-50 transition cursor-pointer",onClick:g=>U(l.key)},[e("div",Fe,n(l.name),1),e("div",Le,[e("div",Ie,[l.score!==null?(a(),o("span",Ke,n(l.score)+" 点 ",1)):(a(),o("span",Qe,"未入力"))]),l.score!==null&&_.value?(a(),o("span",{key:0,class:C(["inline-flex justify-center rounded-full px-1.5 sm:px-2 py-0.5 text-[11px] sm:text-xs font-semibold",l.passed?"bg-emerald-50 text-emerald-700":"bg-rose-50 text-rose-700"])},n(l.passed?"合格":"不合格"),3)):l.score!==null?(a(),o("span",Ze," 判定なし ")):(a(),o("span",Ge))])],8,De))),128))])]),e("div",He,[E(j(J),{href:s.route("logout"),method:"post",as:"button",class:"inline-flex items-center justify-center rounded-full border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition"},{default:R(()=>[w(" ログアウト ")]),_:1},8,["href"])])]),N.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 px-4",onClick:Y(T,["self"])},[e("div",We,[Xe,e("div",Ye,[e("div",et,n((d=i.subjects.find(l=>l.key===v.value))==null?void 0:d.name),1),e("div",null,[tt,W(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),type:"number",min:"0",max:"100",inputmode:"numeric",class:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-base sm:text-sm focus:border-purple-500 focus:ring-purple-500"},null,512),[[X,p.value]]),st]),y.value?(a(),o("div",lt,n(y.value),1)):m("",!0)]),e("div",at,[e("button",{type:"button",class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition",onClick:T}," キャンセル "),e("button",{type:"button",class:"rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 transition",onClick:le,disabled:P.value}," 保存 ",8,ot)])])],8,Je)):m("",!0),V.value?(a(),o("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 px-4",onClick:Y(q,["self"])},[e("div",nt,[it,e("div",dt,[e("div",null,[ut,W(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),type:"number",min:"0",max:"100",inputmode:"numeric",class:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-base sm:text-sm focus:border-purple-500 focus:ring-purple-500"},null,512),[[X,h.value]])]),f.value?(a(),o("div",ct,n(f.value),1)):m("",!0)]),e("div",mt,[e("button",{type:"button",class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition",onClick:q}," キャンセル "),e("button",{type:"button",class:"rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 transition",onClick:oe,disabled:M.value}," 更新 ",8,pt)])])],8,rt)):m("",!0)]}),_:1}))}};export{yt as default};
