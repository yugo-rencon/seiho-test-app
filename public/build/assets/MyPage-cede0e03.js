import{Q as ee,k as i,r as _,T as L,s as te,q as se,o as r,c as oe,w as E,a as V,u as d,Z as re,b as e,d as l,t as n,e as c,n as S,g as k,i as A,y as le,F as q,f as ae,j as K,v as Q,h as Z}from"./app-409a0173.js";import{_ as ne}from"./SeihoTestLayout-548acb78.js";const ce={class:"mx-auto w-full max-w-3xl px-6 py-10"},ie={key:0,class:"mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm font-semibold text-emerald-700"},de=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"マイページ"),e("p",{class:"mt-2 text-sm text-gray-500"}," 登録状況の確認や進捗管理ができます。 ")],-1),ue={class:"rounded-2xl border border-gray-100 bg-white p-6 shadow-sm"},me=e("div",{class:"text-sm text-gray-500"},"ログイン中のユーザー",-1),pe={class:"mt-1 text-lg font-semibold text-gray-800"},xe={class:"mt-6 border-t border-gray-100 pt-4"},be=e("div",{class:"text-sm text-gray-500"},"購入状況",-1),ve={class:"mt-2 text-xs text-gray-500"},ye={key:0,class:"mt-3"},fe={id:"score-input",class:"mt-8 rounded-2xl border border-gray-100 bg-white p-6 shadow-sm"},_e={class:"flex items-center justify-between"},ge={class:"flex items-center gap-2"},he=e("div",{class:"text-sm text-gray-500"},"進捗",-1),ke={key:0,class:"inline-flex items-center rounded-full bg-sky-50 px-2 py-0.5 text-xs font-semibold text-sky-700"},we={class:"mt-1 text-lg font-semibold text-gray-800"},Se={class:"text-right"},je=e("div",{class:"text-xs text-gray-500"},"合格基準",-1),Ce={class:"mt-1 flex items-center justify-end gap-2"},Pe={key:0,class:"mt-1 text-xs text-amber-700"},Me={class:"mt-4 h-2 w-full rounded-full bg-gray-100"},Ne={class:"mt-4 text-sm text-gray-700"},Te={key:0,class:"ml-2 inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs font-semibold text-emerald-700"},Ee={key:0,class:"mt-1 text-xs text-amber-700"},Ve={class:"mt-6 space-y-3"},qe=["onClick"],Be={class:"text-sm font-semibold text-gray-800"},ze={class:"flex items-center gap-3"},Fe={class:"text-sm text-gray-600"},Re={key:0},$e={key:1,class:"text-gray-400"},Oe={class:"mt-8 flex justify-center"},Ue=["onClick"],De={class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl"},Le=e("div",{class:"flex items-center justify-between"},[e("div",{class:"text-lg font-semibold text-gray-900"},"結果を入力")],-1),Ae={class:"mt-4 space-y-4"},Ke={class:"text-sm font-semibold text-gray-800"},Qe=e("label",{class:"block text-sm font-semibold text-gray-700"}," 点数（0〜100） ",-1),Ze=e("p",{class:"mt-1 text-xs text-gray-500"}," 空欄で保存すると「未入力」に戻せます。 ",-1),Ge={key:0,class:"rounded-lg border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-700"},He={class:"mt-6 flex items-center justify-end gap-3"},Ie=["disabled"],Je=["onClick"],We={class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl"},Xe=e("div",{class:"flex items-center justify-between"},[e("div",{class:"text-lg font-semibold text-gray-900"},"合格基準を変更")],-1),Ye={class:"mt-4 space-y-4"},et=e("label",{class:"block text-sm font-semibold text-gray-700"}," 合格基準（0〜100） ",-1),tt={key:0,class:"rounded-lg border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-700"},st={class:"mt-6 flex items-center justify-end gap-3"},ot=["disabled"],rt=720,ct={__name:"MyPage",props:{passScore:{type:Number,required:!1,default:null},subjects:{type:Array,required:!0},results:{type:Object,required:!0},hasPremium:{type:Boolean,required:!0}},setup(B){var O,U,D;const z=ee(),G=((U=(O=z.props)==null?void 0:O.auth)==null?void 0:U.user)||null,F=i(()=>{var s,t;return((t=(s=z.props)==null?void 0:s.flash)==null?void 0:t.status)??null}),a=B,b=_({...a.results}),j=_(!1),v=_(((D=a.subjects[0])==null?void 0:D.key)||""),y=_(""),f=_(""),m=L({subject_key:"",score:null});te(()=>a.results,s=>{b.value={...s}},{deep:!0});const R=s=>{var u,x,o;f.value="",m.clearErrors(),v.value=s||((u=a.subjects[0])==null?void 0:u.key)||"";const t=((o=(x=b.value)==null?void 0:x[v.value])==null?void 0:o.score)??"";y.value=t===null?"":String(t),j.value=!0},C=()=>{j.value=!1},H=()=>{if(!v.value){f.value="科目を選択してください。";return}const s=y.value===""||y.value===null;if(s)m.score=null;else{const t=Number(y.value);if(Number.isNaN(t)||t<0||t>100){f.value="0〜100の点数を入力してください。";return}m.score=t}m.subject_key=v.value,m.post(route("mypage.results"),{preserveScroll:!0,onSuccess:()=>{if(s){const t={...b.value};delete t[v.value],b.value=t}else b.value={...b.value,[v.value]:{score:Number(y.value)}};C()},onError:()=>{f.value=m.errors.score||m.errors.subject_key||"保存に失敗しました。"}})};se(()=>{const t=new URLSearchParams(window.location.search).get("open_subject");t&&a.subjects.some(u=>u.key===t)&&R(t)});const p=L({pass_score:a.passScore??""}),P=_(!1),I=()=>{p.pass_score=a.passScore??"",p.clearErrors(),P.value=!0},M=()=>{P.value=!1},J=()=>{p.post(route("mypage.passScore"),{preserveScroll:!0,onSuccess:()=>{M()}})},g=i(()=>a.passScore!==null),w=i(()=>a.subjects.map(s=>{var x,o;const t=((o=(x=b.value)==null?void 0:x[s.key])==null?void 0:o.score)??null,u=g.value&&t!==null&&t>=a.passScore;return{...s,score:t,passed:u}})),h=i(()=>w.value.filter(s=>s.passed).length),W=i(()=>h.value===8),N=i(()=>w.value.map(s=>s.score??0).reduce((s,t)=>s+t,0)),X=i(()=>w.value.filter(s=>s.score!==null).length===8),Y=i(()=>X.value&&h.value===8&&N.value>=720),T=i(()=>Math.max(0,rt-N.value)),$=i(()=>T.value===0);return(s,t)=>(r(),oe(ne,{title:"マイページ"},{default:E(()=>{var u,x;return[V(d(re),{title:"マイページ"}),e("div",ce,[F.value?(r(),l("div",ie,n(F.value),1)):c("",!0),de,e("div",ue,[me,e("div",pe,n(((u=d(G))==null?void 0:u.email)||"未ログイン"),1),e("div",xe,[be,e("div",{class:S(["mt-1 text-sm font-semibold",a.hasPremium?"text-emerald-700":"text-gray-700"])},n(a.hasPremium?"プレミアムプラン購入済み":"プレミアムプラン未購入"),3),e("p",ve,n(a.hasPremium?"全ての解説を閲覧できます。":"プレミアムプランで全ての解説を閲覧できます。"),1),a.hasPremium?c("",!0):(r(),l("div",ye,[V(d(A),{href:s.route("pricing"),class:"inline-flex items-center justify-center rounded-full bg-purple-600 px-4 py-2 text-xs font-semibold text-white hover:bg-purple-700 transition"},{default:E(()=>[k(" 料金プランを見る ")]),_:1},8,["href"])]))])]),e("div",fe,[e("div",_e,[e("div",null,[e("div",ge,[he,W.value?(r(),l("span",ke," 全科目合格達成 ")):c("",!0)]),e("div",we,n(h.value)+"/8 ",1)]),e("div",Se,[je,e("div",Ce,[e("span",{class:S(["text-sm font-semibold",g.value?"text-gray-700":"text-amber-700"])},n(g.value?`${B.passScore} 点`:"未入力"),3),e("button",{type:"button",class:"rounded-full border border-purple-200 bg-white px-3 py-1 text-xs font-semibold text-purple-700 hover:bg-purple-50 transition",onClick:I},n(g.value?"変更":"入力"),1)]),g.value?c("",!0):(r(),l("div",Pe," 合格基準を入力してください "))])]),e("div",Me,[e("div",{class:"h-2 rounded-full bg-purple-500",style:le({width:`${h.value/8*100}%`})},null,4)]),e("div",Ne,[k(" 合計 "+n(N.value)+" / 800 点 ",1),Y.value?(r(),l("span",Te," 優秀賞対象 ")):c("",!0)]),e("div",{class:S(["mt-2 inline-flex items-center rounded-lg px-3 py-1.5 text-sm font-semibold",$.value?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"])},[$.value?(r(),l(q,{key:0},[k(" 優秀賞基準（720点）到達 ")],64)):(r(),l(q,{key:1},[k(" 優秀賞基準（720点）まであと "+n(T.value)+" 点 ",1)],64))],2),T.value===0&&h.value<8?(r(),l("div",Ee," 720点に到達していますが、優秀賞は全8科目の合格が必要です ")):c("",!0),e("div",Ve,[(r(!0),l(q,null,ae(w.value,o=>(r(),l("div",{key:o.key,class:"flex items-center justify-between rounded-xl border border-gray-100 px-4 py-3 hover:bg-gray-50 transition cursor-pointer",onClick:lt=>R(o.key)},[e("div",Be,n(o.name),1),e("div",ze,[e("div",Fe,[o.score!==null?(r(),l("span",Re,n(o.score)+" 点 ",1)):(r(),l("span",$e,"未入力"))]),o.score!==null?(r(),l("span",{key:0,class:S(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",o.passed?"bg-emerald-50 text-emerald-700":"bg-rose-50 text-rose-700"])},n(o.passed?"合格":"不合格"),3)):c("",!0)])],8,qe))),128))])]),e("div",Oe,[V(d(A),{href:s.route("logout"),method:"post",as:"button",class:"inline-flex items-center justify-center rounded-full border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition"},{default:E(()=>[k(" ログアウト ")]),_:1},8,["href"])])]),j.value?(r(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 px-4",onClick:Z(C,["self"])},[e("div",De,[Le,e("div",Ae,[e("div",Ke,n((x=a.subjects.find(o=>o.key===v.value))==null?void 0:x.name),1),e("div",null,[Qe,K(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500"},null,512),[[Q,y.value]]),Ze]),f.value?(r(),l("div",Ge,n(f.value),1)):c("",!0)]),e("div",He,[e("button",{type:"button",class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition",onClick:C}," キャンセル "),e("button",{type:"button",class:"rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 transition",onClick:H,disabled:d(m).processing}," 保存 ",8,Ie)])])],8,Ue)):c("",!0),P.value?(r(),l("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 px-4",onClick:Z(M,["self"])},[e("div",We,[Xe,e("div",Ye,[e("div",null,[et,K(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>d(p).pass_score=o),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500"},null,512),[[Q,d(p).pass_score]])]),d(p).errors.pass_score?(r(),l("div",tt,n(d(p).errors.pass_score),1)):c("",!0)]),e("div",st,[e("button",{type:"button",class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition",onClick:M}," キャンセル "),e("button",{type:"button",class:"rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 transition",onClick:J,disabled:d(p).processing}," 更新 ",8,ot)])])],8,Je)):c("",!0)]}),_:1}))}};export{ct as default};
